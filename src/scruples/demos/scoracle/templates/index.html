<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta
       name="viewport"
       content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <title>Scoracle: Estimate Oracle Scores</title>

    <!-- bootstrap -->
    <link
       rel="stylesheet"
       href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css"
       integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO"
       crossorigin="anonymous">

    <!-- Code Highlighting -->
    <link
       rel="stylesheet"
       href="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.16.2/build/styles/monokai-sublime.min.css"
       integrity="sha384-jO9iEb/dRjGM8YVa0IZ5vaWgp05Cnhp/QVnbq4B5frdQvrpDlxVB5odH9Gne1o3+"
       crossorigin="anonymous">
    <script
       async
       src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.16.2/build/highlight.min.js"
       integrity="sha384-sBdaRRScDKKRhhw8Fmr+XBy1lvOM3188vYhxIBoiQ6RYxijav6vM7yOnyXRR369O"
       crossorigin="anonymous"
       onload="hljs.initHighlightingOnLoad();">
    </script>

    <!-- KaTeX (math type setting) -->
    <link
       rel="stylesheet"
       href="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.css"
       integrity="sha384-zB1R0rpPzHqg7Kpt0Aljp8JPLqbXI3bhnPWROx27a9N0Ll6ZP/+DiW/UqRcLbRjq"
       crossorigin="anonymous">
    <script
       defer
       src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.js"
       integrity="sha384-y23I5Q6l+B6vatafAwxRu/0oK/79VlbSz7Q9aiSZUvyWYIYsd+qj+o24G5ZU2zJz"
       crossorigin="anonymous">
    </script>
    <script
       defer
       src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/auto-render.min.js"
       integrity="sha384-kWPLUVMOks5AQFrykwIup5lo0m3iMkkHrD0uJ4H5cjeGihAutqP0yW0J6dpFiVkI"
       crossorigin="anonymous"
       onload="renderMathInElement(document.body);">
    </script>
  </head>
  <body
     data-spy="scroll"
     data-target="#navbar"
     data-offset="0"
     style="position: relative;">
    <nav
       id="navbar"
       class="navbar sticky-top navbar-light navbar-expand-sm bg-light shadow-sm">
      <div class="container">
        <a class="navbar-brand" href="#">&#x1F52E; Scoracle</a>
        <button
           class="navbar-toggler"
           type="button"
           data-toggle="collapse"
           data-target="#navbar-links"
           aria-controls="navbar-links"
           aria-expanded="false"
           aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div
           id="navbar-links"
           class="collapse navbar-collapse">
          <ul class="navbar-nav">
            <li class="nav-item">
              <a class="nav-link" href="#about">About</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#demo">Demo</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#api">API</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#background">Background</a>
            </li>
          </ul>
        </div>
      </div>
    </nav>

    <div class="jumbotron jumbotron-fluid">
      <div class="container">
        <h1 class="display-2">Scoracle</h1>
        <p class="lead">
          What's the best performance on your data? &#x1F916;
        </p>
      </div>
    </div>

    <div
       id="about"
       class="container pt-5">
      <div class="row">
        <div class="col-12">
          <h2 class="display-4">About</h2>
        </div>
      </div>
      <div class="row">
        <div class="col-12">
          <p>
            When tackling a dataset, it's important to know the best possible
            performance. There's no point studying a solved problem!
          </p>
          <p>
            If every label were correct (the one chosen most often) then models
            could score perfectly. In practice, a handful of annotators decide
            each gold label, getting some wrong by pure chance. So, even the
            perfect model won't get the perfect score.
          </p>
          <p>
            We can formalize &ldquo;the perfect model&rdquo; as an oracle
            that knows how people annotate each example on average. This demo
            estimates the oracle's score on your data.
          </p>
          <p>
            Submit your dataset and discover the best possible performance!
            You can also check out
            the <a href="https://github.com/allenai/scruples">code</a> or read
            some <a href="#background">background</a> on how we compute the
            estimate.
          </p>
        </div>
      </div>
    </div>

    <div
       id="demo"
       class="container pt-5">
      <div class="row">
        <div class="col-12">
          <h2 class="display-4">Demo</h2>
          <p>
            To compute the oracle score, you'll need a classification dataset
            with a fixed set of classes and multiple annotators per
            question. We'll estimate the score from the label counts.
          </p>
        </div>
      </div>
      <div class="row">
        <div class="col-12">
          <h3>Upload Data</h3>
        </div>
        <div class="col-12">
          <form id="demo-form">
            <div class="row">
              <div class="col-12 my-2">
                <div class="form-group">
                  <label for="demo-form-name">Name the Dataset.</label>
                  <input
                     id="demo-form-name"
                     class="form-control"
                     type="text"
                     placeholder="Example Dataset">
                </div>
                <div id="demo-form-name-errors"></div>
              </div>
              <div class="col-12 mt-2 mb-4">
                <label class="w-100">Choose your Metrics.</label>
                {% for metric in metrics %}
                <div class="form-check form-check-inline">
                  <input
                     id="demo-form-metric-{{ loop.index0 }}"
                     class="form-check-input demo-form-metric"
                     type="checkbox"
                     value="{{ metric }}">
                  <label
                     class="form-check-label"
                     for="demo-form-metric-{{ loop.index0 }}">
                    {{ metric }}
                  </label>
                </div>
                {% endfor %}
                <div id="demo-form-metric-errors"></div>
              </div>
              <div class="col-12 my-2">
                <p class="mt-1 mb-3">
                  Provide the data, a matrix of integers with
                  the \(ij^{th}\) entry providing the number of annotators that
                  marked example \(i\) in class \(j\).
                </p>
                <ul
                   id="demo-form-tabs"
                   class="nav nav-tabs"
                   role="tablist">
                  <li class="nav-item">
                    <a
                       id="demo-form-text-tab"
                       class="nav-link active"
                       data-toggle="tab"
                       href="#upload-text"
                       role="tab"
                       aria-controls="upload-text"
                       aria-selected="true">
                      Text
                    </a>
                  </li>
                  <li class="nav-item">
                    <a
                       id="demo-form-file-tab"
                       class="nav-link"
                       data-toggle="tab"
                       href="#upload-file"
                       role="tab"
                       aria-controls="upload-file"
                       aria-selected="false">
                      File
                    </a>
                  </li>
                </ul>
                <div
                   id="demo-form-tabs-content"
                   class="tab-content">
                  <div
                     id="upload-text"
                     class="tab-pane my-2 fade show active"
                     role="tabpanel"
                     aria-labelledby="demo-form-text-tab">
                    <label for="demo-form-text">Paste in the JSON.</label>
                    <textarea
                       id="demo-form-text"
                       class="form-control"
                       rows="3"
                       placeholder="[[1, 5], [2, 1]]"></textarea>
                  </div>
                  <div
                     id="upload-file"
                     class="tab-pane my-2 fade"
                     role="tabpanel"
                     aria-labelledby="demo-form-file-tab">
                    <div class="form-group">
                      <label for="demo-form-file">Upload the JSON.</label>
                      <input
                         id="demo-form-file"
                         class="form-control-file"
                         type="file">
                    </div>
                  </div>
                  <div id="demo-form-upload-errors"></div>
                </div>
              </div>
              <div class="col-12 my-2">
                <button
                   class="btn btn-primary"
                   type="submit">
                  Submit
                </button>
              </div>
            </div>
          </form>
        </div>
      </div>
      <div class="row pt-4 pb-2">
        <div class="col-12">
          <h3>View Results</h3>
        </div>
        <div class="col-12">
          <figure class="figure w-100">
            <figcaption class="figure-caption text-center mb-2">
              Estimated oracle scores.
            </figcaption>
            <table
               id="demo-display-table"
               class="table table-hover">
              <thead>
                <tr>
                  <th scope="col">name</th>
                  <th scope="col">metric</th>
                  <th scope="col">score</th>
                </tr>
              </thead>
              <tbody id="demo-display"></tbody>
            </table>
          </figure>
        </div>
      </div>
    </div>

    <div
       id="api"
       class="container pt-5">
      <div class="row">
        <div class="col-12">
          <h2 class="display-4">API</h2>
        </div>
      </div>
      <div class="row my-2">
        <div class="col-12">
          <h3>Documentation</h3>
          <p>
            This demo provides a ReST API at <code>/api/score</code>. To use
            it, <code>POST</code> a JSON object with the following keys:
          </p>
          <dl class="row">
            <dt class="col-sm-3 col-md-2">metrics</dt>
            <dd class="col-sm-9 col-md-10">
              A list of strings representing metrics to compute. Supported metrics include:
              <ul>
                {% for metric in metrics %}
                <li><code>"{{ metric }}"</code></li>
                {% endfor %}
              </ul>
            </dd>
            <dt class="col-sm-3 col-md-2">labelCounts</dt>
            <dd class="col-sm-9 col-md-10">
              An array of arrays of integers, where the \(ij^{th}\) entry is
              the number of annotators that labeled example \(i\) as in class
              \(j\).
            </dd>
          </dl>
        </div>
        <div class="col-12">
          <h3>Examples</h3>
          <p>
            Using <a href="https://curl.haxx.se/">cURL</a>, you could hit
            the API as follows:
          </p>
          <pre><code class="bash rounded">
$ curl \
>   --request POST \
>   --header "Content-Type: application/json" \
>   --data '{"metrics": ["accuracy", "f1 (macro)"], "labelCounts": [[1, 3], [4, 0]]}' \
>   $DOMAIN/api/score
[
  {
    "metric": "accuracy",
    "score": 0.8878
  },
  {
    "metric": "f1 (macro)",
    "score": 0.8485666666666668
  }
]
          </code></pre>
          <p>Or using <a href="https://httpie.org/">HTTPie</a>:</p>
          <pre><code class="bash rounded">
$ http \
>   post \
>   $DOMAIN/api/score \
>   labelCounts:='[[3, 2], [0, 5]]' \
>   metrics:='["accuracy", "f1 (macro)"]'
HTTP/1.0 200 OK
Content-Length: 118
Content-Type: application/json
Date: Wed, 04 Dec 2019 23:15:50 GMT
Server: Werkzeug/0.15.4 Python/3.7.0

[
    {
        "metric": "accuracy",
        "score": 0.7626
    },
    {
        "metric": "f1 (macro)",
        "score": 0.6836
    }
]
          </code></pre>
        </div>
      </div>
    </div>

    <div
       id="background"
       class="container pt-5">
      <div class="row">
        <div class="col-12">
          <h2 class="display-4">Background</h2>
        </div>
      </div>
      <div class="row py-2">
        <div class="col-12">
          <h3>Defining Oracle Score</h3>
        </div>
        <div class="col-12">
          <p>
            To formalize &ldquo;best possible&rdquo; performance, we define
            an <em>oracle</em> which knows exactly how people annotate each
            example on average. For example \(i\), let \(p_{ij}\) be the
            probability that a random annotator assigns it to class \(j\),
            \(Y_{ij}\) be the count of annotations placing it in class \(j\),
            and \(N_i\) the total number of annotations it has. Using slice
            syntax to denote vectors, we have:

            \[ Y_{i:} \sim \operatorname{Multinomial}(p_{i:}, N_i) \]

            So given a loss, \(\ell\), the oracle predicts as well as
            possible knowing the class probabilities for each example
            (\(p\)) but not the annotations that were actually
            collected (\(Y\)). For ease of computation, we use the most
            probable label or the label distribution (whichever makes more
            sense) &mdash; even though these might not be optimal for all
            metrics.
          </p>
        </div>
        <div class="col-12">
          <h3>Estimating Oracle Score</h3>
        </div>
        <div class="col-12">
          <p>
            Since the annotations (\(Y\))
            are <a href="https://en.wikipedia.org/wiki/Multinomial_distribution">multinomial</a>,
            we model the class probabilities (\(p\)) with
            the <a href="https://en.wikipedia.org/wiki/Conjugate_prior">conjugate</a>,
            <a href="https://en.wikipedia.org/wiki/Dirichlet_distribution">Dirichlet</a>
            distribution:

            \[ p_{i:} \sim \operatorname{Dirichlet}(\alpha) \]

            Following
            the <a href="https://en.wikipedia.org/wiki/Empirical_Bayes_method">empirical
            Bayesian</a> approach, we fit the prior (\(\alpha\))
            via <a href="https://en.wikipedia.org/wiki/Maximum_likelihood_estimation">maximum
            likelihood</a> to obtain \(\hat{\alpha}\). Our estimate is then
            the oracle's expected loss over the posterior:

            \[ s \coloneqq \mathbb{E}_{p \mid Y, \hat{\alpha}}[\ell(p, Y)] \]

          </p>
          <p>
            For the mathematical details, check out the
            <a href="https://github.com/allenai/scruples/blob/da41cf8976e96ceb05fdeca887b460ea1baf5629/src/scruples/utils.py#L460">code</a>
            for computing the oracle score.
          </p>
        </div>
      </div>
    </div>

    <footer class="w-100 text-center py-5">
      <small>
        &copy; <a href="https://allenai.org">
          The Allen Institute for Artificial Intelligence
        </a> - All Rights Reserved
        | <a href="https://allenai.org/privacy-policy.html">Privacy Policy</a>
        | <a href="https://allenai.org/terms.html">Terms of Use</a>
      </small>
    </footer>

    <!-- Bootstrap JS and it's dependencies -->
    <script
       src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
       integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
       crossorigin="anonymous">
    </script>
    <script
       src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js"
       integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49"
       crossorigin="anonymous">
    </script>
    <script
       src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js"
       integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy"
       crossorigin="anonymous">
    </script>

    <!-- Custom JavaScript -->
    <script>
      // helper functions

      /**
       * Validate and return the dataset's name.
       *
       * @param {Array} errors - An array for accumulating error messages.
       *
       * @returns {string} The dataset's name.
       */
      function validateDatasetName(errors) {
        var datasetName;

        // fetch the dataset name
        datasetName = document
          .getElementById('demo-form-name')
          .value;

        // validate the dataset name
        if (datasetName === '') {
          errors.push({
            element: 'demo-form-name-errors',
            error: 'No name provided',
            message: 'Please provide a name for the dataset.'
          });
        }

        return datasetName;
      }

      /**
       * Validate and return the metrics.
       *
       * @param {Array} errors - An array for accumulating error messages.
       *
       * @returns {Array} The array of selected metrics.
       */
      function validateMetrics(errors) {
        var metrics;

        // fetch the metrics
        metrics = Array
          .from(document.getElementsByClassName('demo-form-metric'))
          .map(function(el) { return el.checked ? el.value : null; })
          .filter(function(el) { return el !== null; });

        // validate the metrics
        if (metrics.length === 0) {
          errors.push({
            element: 'demo-form-metric-errors',
            error: 'No metrics selected',
            message: 'Please choose one or more metrics to compute a score.'
          });
        }

        return metrics;
      }

      /**
       * Validate and return a promise for the label counts string.
       *
       * @param {Array} errors - An array for accumulating error messages.
       *
       * @returns {Promise} A promise for the label counts string.
       */
      function validateLabelCountsString(errors) {
        var labelCountsStringPromise,
            useTextUpload;

        // validate and retrieve the label counts
        useTextUpload = document
          .getElementById('upload-text')
          .classList
          .contains('active');
        if (useTextUpload) {
          labelCountsStringPromise = Promise.resolve(
            document
              .getElementById('demo-form-text')
              .value
          );
        } else {
          var fileUploaded;

          fileUploaded = document
            .getElementById('demo-form-file')
            .files
            .length > 0;
          if (!fileUploaded) {
            errors.push({
              element: 'demo-form-upload-errors',
              error: 'No file uploaded',
              message: 'Please upload a file to compute a score.'
            });
            return Promise.reject(new Error('No file uploaded.'));
          }
          labelCountsStringPromise = new Promise(function(resolve, reject) {
            reader = new FileReader();
            reader.onload = function(event) {
              resolve(reader.result);
            }
            reader.onerror = function(event) {
              reader.abort();
              reject(new Error('Failed to read file.'));
            }
            reader.readAsText(
              document
                .getElementById('demo-form-file')
                .files[0]
            );
          });
        }

        return labelCountsStringPromise;
      }

      /**
       * Validate and return the label counts JSON.
       *
       * @param {string} labelCountsString - The label counts string.
       * @param {Array} errors - An array for accumulating error messages.
       *
       * @returns {Array} The matrix of label counts.
       */
      function validateLabelCountsJSON(labelCountsString, errors) {
        var labelCounts;

        // parse the labelCounts JSON
        try {
          labelCounts = JSON.parse(labelCountsString);
        } catch(e) {
          errors.push({
            element: 'demo-form-upload-errors',
            error: 'Data is not JSON',
            message: 'Please check the uploaded data. It does not appear to be'
                     + ' well-formed JSON.'
          });
          return null;
        }

        // validate the type and shape of labelCounts
        if (!Array.isArray(labelCounts)) {
          errors.push({
            element: 'demo-form-upload-errors',
            error: 'Data must be an array',
            message: 'The uploaded data should be an array of arrays of ints.'
          });
        } else if (labelCounts.length === 0) {
          errors.push({
            element: 'demo-form-upload-errors',
            error: 'Data must be a non-empty array',
            message: 'The uploaded data should be a non-empty array.'
          });
        } else if (!Array.isArray(labelCounts[0])) {
          errors.push({
            element: 'demo-form-upload-errors',
            error: 'Data must be an array of arrays',
            message: 'The uploaded data should be an array of arrays of ints.'
          });
        } else if (labelCounts[0].length === 0) {
          errors.push({
            element: 'demo-form-upload-errors',
            error: 'Data must be an array of non-empty arrays',
            message: 'The uploaded data should be an array of non-empty arrays.'
          });
        } else if (!Number.isInteger(labelCounts[0][0])) {
          errors.push({
            element: 'demo-form-upload-errors',
            error: 'Data must be an array of arrays of integers',
            message: 'Please check that every element of the data is an integer.'
          });
        } else if (labelCounts.some(function(el) { return el.length !== labelCounts[0].length; })) {
          errors.push({
            element: 'demo-form-upload-errors',
            error: 'Data is not rectangular',
            message: 'The uploaded data must be rectangular; every sub-array must'
                     + ' have the same length.'
          });
        } else if (labelCounts.some(function(row) { return row.some(function(el) { return el < 0; }); })) {
          errors.push({
            element: 'demo-form-upload-errors',
            error: 'Data contains negative elements',
            message: 'The uploaded data must contain only nonnegative elements.'
          });
        }

        return labelCounts;
      }

      /**
       * Display errors to the user.
       *
       * @param {Array} errors - The error messages to display.
       */
      function displayErrors(errors) {
        errors.forEach(function(error) {
          document.getElementById(error['element']).insertAdjacentHTML(
            'beforeend',
             `<div\
                 class="alert alert-danger alert-dismissable fade show"\
                 role="alert">\
                <strong>${error['error']}:</strong> ${error['message']}\
                <button\
                   class="close"\
                   type="button"\
                   data-dismiss="alert"\
                   aria-label="Close">\
                  <span aria-hidden="true">&times;</span>\
                </button>\
              </div>`
          );
        });
      }

      /**
       * Clear the form inputs.
       */
      function clearForm() {
        // clear dataset name
        document
          .getElementById('demo-form-name')
          .value = '';
        // clear the metrics
        Array
          .from(document.getElementsByClassName('demo-form-metric'))
          .forEach(function(el) { el.checked = false; });
        // clear the label counts
        document
          .getElementById('demo-form-text')
          .value = '';
        document
          .getElementById('demo-form-file')
          .value = '';
      }

      /**
       * Clear the error messages.
       */
      function clearErrors() {
        document
          .getElementById('demo-form-name-errors')
          .innerHTML = '';
        document
          .getElementById('demo-form-metric-errors')
          .innerHTML = '';
        document
          .getElementById('demo-form-upload-errors')
          .innerHTML = '';;
      }

      /** The number of submissions in progress. */
      var nSubmissionsInProgress = 0;

      /**
       * Add the progress bar in the demo display.
       *
       * Increment the number of submissions in progress and add the progress
       * bar to the UI if it's not present.
       */
      function addProgress() {
        var progressBar;

        // signal that an additional submission is in progress.
        nSubmissionsInProgress++;

        // if the progress bar exists, there's nothing to do.
        progressBar = document.getElementById('submission-progress');
        if (progressBar !== null) { return; }

        document
          .getElementById('demo-display-table')
          .insertAdjacentHTML(
            'beforebegin',
            `<div\
                id="submission-progress"\
                class="progress">\
              <div\
                 class="progress-bar progress-bar-striped progress-bar-animated"\
                 role="progressbar"\
                 aria-valuenow="100"\
                 aria-valuemin="100"\
                 aria-valuemax="100"\
                 style="width: 100%">\
              </div>\
             </div>`
          );
      }

      /**
       * Remove the progress bar from the demo display.
       *
       * Decrement the number of submissions in progress and remove the
       * progress bar from the UI if no submissions are left in progress.
       */
      function removeProgress() {
        var progressBar;

        nSubmissionsInProgress = Math.max(nSubmissionsInProgress - 1, 0);

        // if there are still submissions in progress, there's nothing to do.
        if (nSubmissionsInProgress > 0) { return; }

        // if the progress bar doesn't exist, there's nothing to do.
        progressBar = document.getElementById('submission-progress')
        if (progressBar === null) { return; }

        progressBar.remove();
      }

      // set a handler for form submission
      var form = document.getElementById('demo-form');
      form.onsubmit = function(e) {
        e.preventDefault();

        var datasetName,
            errors,
            labelCountsStringPromise,
            metrics,
            xhr;

        // add the progress bar
        addProgress();

        // set up error handling
        clearErrors();

        // collect errors for later display to the user
        errors = [];

        // validate and fetch the data
        datasetName = validateDatasetName(errors);
        metrics = validateMetrics(errors);
        labelCountsStringPromise = validateLabelCountsString(errors);
        labelCountsStringPromise.then(function(labelCountsString) {
          var labelCounts;

          labelCounts = validateLabelCountsJSON(labelCountsString, errors);

          // check for errors
          if (errors.length > 0) {
            displayErrors(errors);
            removeProgress();
            return;
          }

          // clear the form
          clearForm();

          // submit the form
          xhr = new XMLHttpRequest();
          xhr.open('POST', '/api/score', true);
          xhr.setRequestHeader('Content-type', 'application/json');
          xhr.onreadystatechange = function() {
            if (xhr.readyState == 4 && xhr.status == 200) {
              var responseData;
              responseData = JSON.parse(
                xhr.responseText,
                function(key, value) {
                  if (key === 'score' && value === 'NaN') { return NaN; }
                  if (key === 'score' && value === 'Infinite') { return Infinite; }
                  if (key === 'score' && value === '-Infinite') { return -Infinite; }
                  return value
              });
              for (var i = 0; i < responseData.length; i++) {
                document
                  .getElementById('demo-display')
                  .insertAdjacentHTML(
                    'afterbegin',
                    `<tr>\
                       <td>${datasetName}</td>\
                       <td>${responseData[i]['metric']}</td>\
                       <td>${responseData[i]['score']}</td>\
                     </tr>`
                  );
              }
              removeProgress();
            }
          }
          xhr.send(JSON.stringify({metrics: metrics, labelCounts: labelCounts}));
        }).catch(function(error) {
          if (error.message === 'Failed to read file.') {
            errors.push({
              element: 'demo-form-upload-errors',
              error: 'Bad file',
              message: 'Failed to read file.'
            });
          }

          displayErrors(errors);
          removeProgress();
        });

        return false;
      }
    </script>
  </body>
</html>
